#!/usr/bin/env bash
set -e # exit immediately upon failure
# set -x # log all cmds before executing

# ROOT=~/projects
ROOT=`pwd`

statrepos() {
  repo=$(dirname $1)
  cd $repo
  STATUS=$(~/.bash-git-prompt/gitstatus.sh 2>/dev/null | tr '[:space:]' ',' | tr '0' ' ')
  echo $(basename $repo),$STATUS$"\\n"
}

# need to export function for gnu parallel to see it
export -f statrepos

ALLSTATS=$(find $ROOT/ -name .git | parallel statrepos {} | sort)

HEADER="repo,branch,remote,●,✖,✚,…,⚑,✔""\n"

echo -e $HEADER$ALLSTATS | column -t -s','
